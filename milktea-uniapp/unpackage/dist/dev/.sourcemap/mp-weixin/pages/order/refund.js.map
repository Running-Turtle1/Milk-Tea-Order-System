{"version":3,"file":"refund.js","sources":["pages/order/refund.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvb3JkZXIvcmVmdW5kLnZ1ZQ"],"sourcesContent":["<template>\n\t<view class=\"refund-container\">\n\t\t<view class=\"header\">\n\t\t\t<text class=\"title\">申请退款</text>\n\t\t</view>\n\t\t\n\t\t<view class=\"refund-form\">\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<text class=\"item-label\">订单编号</text>\n\t\t\t\t<text class=\"item-value\">{{orderNo}}</text>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<text class=\"item-label\">退款金额</text>\n\t\t\t\t<view class=\"amount-input\">\n\t\t\t\t\t<text class=\"currency\">¥</text>\n\t\t\t\t\t<input \n\t\t\t\t\t\ttype=\"digit\"\n\t\t\t\t\t\tv-model=\"refundAmount\"\n\t\t\t\t\t\tplaceholder=\"请输入退款金额\"\n\t\t\t\t\t\tclass=\"amount-value\"\n\t\t\t\t\t\t:maxlength=\"10\"\n\t\t\t\t\t\t@input=\"checkAmount\"\n\t\t\t\t\t/>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<text class=\"item-label\">退款原因</text>\n\t\t\t\t<picker @change=\"onReasonChange\" :value=\"reasonIndex\" :range=\"reasonOptions\">\n\t\t\t\t\t<view class=\"picker-value\">\n\t\t\t\t\t\t<text>{{reasonOptions[reasonIndex] || '请选择退款原因'}}</text>\n\t\t\t\t\t\t<view class=\"arrow\"></view>\n\t\t\t\t\t</view>\n\t\t\t\t</picker>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<text class=\"item-label\">退款方式</text>\n\t\t\t\t<picker @change=\"onMethodChange\" :value=\"methodIndex\" :range=\"methods\" range-key=\"name\">\n\t\t\t\t\t<view class=\"picker-value\">\n\t\t\t\t\t\t<text>{{methods[methodIndex].name || '请选择退款方式'}}</text>\n\t\t\t\t\t\t<view class=\"arrow\"></view>\n\t\t\t\t\t</view>\n\t\t\t\t</picker>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"form-item textarea-item\">\n\t\t\t\t<text class=\"item-label\">备注说明</text>\n\t\t\t\t<textarea \n\t\t\t\t\tv-model=\"remark\"\n\t\t\t\t\tplaceholder=\"请输入退款说明（选填）\"\n\t\t\t\t\tclass=\"remark-textarea\"\n\t\t\t\t\tmaxlength=\"200\"\n\t\t\t\t></textarea>\n\t\t\t\t<text class=\"textarea-count\">{{remark.length}}/200</text>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<view class=\"refund-tips\">\n\t\t\t<view class=\"tip-item\">\n\t\t\t\t<text class=\"tip-title\">退款说明:</text>\n\t\t\t\t<text class=\"tip-content\">1. 退款金额不能超过订单支付金额</text>\n\t\t\t\t<text class=\"tip-content\">2. 提交后需等待商家审核，请耐心等待</text>\n\t\t\t\t<text class=\"tip-content\">3. 退款将原路返回，预计1-7个工作日到账</text>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<view class=\"submit-btn\" @click=\"submitRefund\">提交申请</view>\n\t</view>\n</template>\n\n<script>\n\timport api from '@/utils/api.js';\n\t\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\torderNo: '',\n\t\t\t\torderAmount: 0,\n\t\t\t\trefundAmount: '',\n\t\t\t\treasonOptions: [\n\t\t\t\t\t'商品质量问题',\n\t\t\t\t\t'商品口味不合适',\n\t\t\t\t\t'送达时间过长',\n\t\t\t\t\t'商品包装破损',\n\t\t\t\t\t'商品错误',\n\t\t\t\t\t'重复下单',\n\t\t\t\t\t'不想要了',\n\t\t\t\t\t'其他原因'\n\t\t\t\t],\n\t\t\t\treasonIndex: 0,\n\t\t\t\tmethods: [\n\t\t\t\t\t{ id: 1, name: '原路返回' },\n\t\t\t\t\t{ id: 2, name: '退到余额' }\n\t\t\t\t],\n\t\t\t\tmethodIndex: 0,\n\t\t\t\tremark: ''\n\t\t\t}\n\t\t},\n\t\tonLoad(options) {\n\t\t\tif (options.orderNo) {\n\t\t\t\tthis.orderNo = options.orderNo;\n\t\t\t}\n\t\t\t\n\t\t\tif (options.amount) {\n\t\t\t\tthis.orderAmount = parseFloat(options.amount);\n\t\t\t\tthis.refundAmount = this.orderAmount.toFixed(2);\n\t\t\t}\n\t\t},\n\t\tmethods: {\n\t\t\t// 校验退款金额\n\t\t\tcheckAmount() {\n\t\t\t\t// 确保输入的是数字\n\t\t\t\tif (this.refundAmount && !/^\\d+(\\.\\d{0,2})?$/.test(this.refundAmount)) {\n\t\t\t\t\tconst value = this.refundAmount;\n\t\t\t\t\tthis.refundAmount = value.replace(/[^\\d.]/g, '');\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// 确保不超过订单金额\n\t\t\t\tif (parseFloat(this.refundAmount) > this.orderAmount) {\n\t\t\t\t\tthis.refundAmount = this.orderAmount.toFixed(2);\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '退款金额不能超过订单金额',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\t// 选择退款原因\n\t\t\tonReasonChange(e) {\n\t\t\t\tthis.reasonIndex = e.detail.value;\n\t\t\t},\n\t\t\t\n\t\t\t// 选择退款方式\n\t\t\tonMethodChange(e) {\n\t\t\t\tthis.methodIndex = e.detail.value;\n\t\t\t},\n\t\t\t\n\t\t\t// 提交退款申请\n\t\t\tsubmitRefund() {\n\t\t\t\t// 表单验证\n\t\t\t\tif (!this.refundAmount || parseFloat(this.refundAmount) <= 0) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '请输入有效的退款金额',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (this.reasonIndex === undefined) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '请选择退款原因',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// 确认对话框\n\t\t\t\tuni.showModal({\n\t\t\t\t\ttitle: '确认申请',\n\t\t\t\t\tcontent: '确定要提交退款申请吗？',\n\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\tif (res.confirm) {\n\t\t\t\t\t\t\t// 显示加载中\n\t\t\t\t\t\t\tuni.showLoading({\n\t\t\t\t\t\t\t\ttitle: '提交中...'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// 构建请求数据\n\t\t\t\t\t\t\tconst refundData = {\n\t\t\t\t\t\t\t\torderNo: this.orderNo,\n\t\t\t\t\t\t\t\t// 直接使用退款金额（元）\n\t\t\t\t\t\t\t\trefundAmount: parseFloat(this.refundAmount),\n\t\t\t\t\t\t\t\t// 直接传递选择的原因字符串\n\t\t\t\t\t\t\t\treason: this.reasonOptions[this.reasonIndex],\n\t\t\t\t\t\t\t\tremark: this.remark,\n\t\t\t\t\t\t\t\t// 设置退款方式ID（1-原路返回，2-退到余额）\n\t\t\t\t\t\t\t\trefundMethod: this.methods[this.methodIndex].id\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tconsole.log('退款请求数据:', refundData);\n\t\t\t\t\t\t\tconsole.log('订单支付金额:', this.orderAmount);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// 调用API\n\t\t\t\t\t\t\tapi.applyRefund(refundData)\n\t\t\t\t\t\t\t\t.then(res => {\n\t\t\t\t\t\t\t\t\tconsole.log('退款申请响应:', res.data);\n\t\t\t\t\t\t\t\t\tif (res.data.code === 200) {\n\t\t\t\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\t\t\t\ttitle: '申请已提交',\n\t\t\t\t\t\t\t\t\t\t\ticon: 'success'\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t// 延迟返回上一页\n\t\t\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\t\t\tuni.navigateBack();\n\t\t\t\t\t\t\t\t\t\t}, 1500);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\t\t\t\ttitle: res.data.message || '申请失败',\n\t\t\t\t\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.catch(err => {\n\t\t\t\t\t\t\t\t\tconsole.error('网络请求失败:', err);\n\t\t\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\t\t\ttitle: '网络请求失败',\n\t\t\t\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\t\t\t\tuni.hideLoading();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style>\n\t.refund-container {\n\t\tbackground-color: #121212;\n\t\tmin-height: 100vh;\n\t\tpadding-bottom: 40rpx;\n\t}\n\t\n\t.header {\n\t\tpadding: 30rpx;\n\t\tbackground-color: #1a1a1a;\n\t\ttext-align: center;\n\t}\n\t\n\t.title {\n\t\tfont-size: 36rpx;\n\t\tcolor: #ffffff;\n\t\tfont-weight: bold;\n\t}\n\t\n\t.refund-form {\n\t\tmargin: 30rpx;\n\t\tpadding: 30rpx;\n\t\tbackground-color: #1a1a1a;\n\t\tborder-radius: 16rpx;\n\t}\n\t\n\t.form-item {\n\t\tmargin-bottom: 30rpx;\n\t}\n\t\n\t.item-label {\n\t\tdisplay: block;\n\t\tfont-size: 28rpx;\n\t\tcolor: #888888;\n\t\tmargin-bottom: 10rpx;\n\t}\n\t\n\t.item-value {\n\t\tfont-size: 30rpx;\n\t\tcolor: #ffffff;\n\t}\n\t\n\t.amount-input {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tborder-bottom: 2rpx solid #333333;\n\t\tpadding-bottom: 10rpx;\n\t}\n\t\n\t.currency {\n\t\tfont-size: 32rpx;\n\t\tcolor: #ffffff;\n\t\tmargin-right: 10rpx;\n\t}\n\t\n\t.amount-value {\n\t\tflex: 1;\n\t\theight: 60rpx;\n\t\tcolor: #ffffff;\n\t\tfont-size: 32rpx;\n\t}\n\t\n\t.picker-value {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tborder-bottom: 2rpx solid #333333;\n\t\tpadding: 15rpx 0;\n\t}\n\t\n\t.picker-value text {\n\t\tfont-size: 30rpx;\n\t\tcolor: #ffffff;\n\t}\n\t\n\t.arrow {\n\t\twidth: 20rpx;\n\t\theight: 20rpx;\n\t\tborder-right: 4rpx solid #888888;\n\t\tborder-bottom: 4rpx solid #888888;\n\t\ttransform: rotate(45deg);\n\t}\n\t\n\t.textarea-item {\n\t\tposition: relative;\n\t}\n\t\n\t.remark-textarea {\n\t\twidth: 100%;\n\t\theight: 180rpx;\n\t\tbackground-color: #232323;\n\t\tborder-radius: 12rpx;\n\t\tpadding: 20rpx;\n\t\tbox-sizing: border-box;\n\t\tcolor: #ffffff;\n\t\tfont-size: 28rpx;\n\t\tmargin-top: 10rpx;\n\t}\n\t\n\t.textarea-count {\n\t\tposition: absolute;\n\t\tright: 20rpx;\n\t\tbottom: 20rpx;\n\t\tfont-size: 22rpx;\n\t\tcolor: #888888;\n\t}\n\t\n\t.refund-tips {\n\t\tmargin: 0 30rpx 40rpx;\n\t\tpadding: 20rpx 30rpx;\n\t\tbackground-color: #1a1a1a;\n\t\tborder-radius: 12rpx;\n\t}\n\t\n\t.tip-title {\n\t\tdisplay: block;\n\t\tfont-size: 28rpx;\n\t\tcolor: #888888;\n\t\tmargin-bottom: 10rpx;\n\t}\n\t\n\t.tip-content {\n\t\tdisplay: block;\n\t\tfont-size: 24rpx;\n\t\tcolor: #888888;\n\t\tmargin-bottom: 6rpx;\n\t}\n\t\n\t.submit-btn {\n\t\tmargin: 40rpx 30rpx;\n\t\theight: 90rpx;\n\t\tline-height: 90rpx;\n\t\tbackground-color: #7b68ee;\n\t\tcolor: #ffffff;\n\t\tfont-size: 32rpx;\n\t\ttext-align: center;\n\t\tborder-radius: 45rpx;\n\t}\n</style> ","import MiniProgramPage from 'C:/Users/LXD/Desktop/奶茶点单系统/milktea-uniapp/pages/order/refund.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","api","res"],"mappings":"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"}