{"version":3,"file":"user-info.js","sources":["pages/user/user-info.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci91c2VyLWluZm8udnVl"],"sourcesContent":["<template>\n\t<view class=\"user-info-container\">\n\t\t<view class=\"info-header\">\n\t\t\t<view class=\"header-title\">个人信息</view>\n\t\t</view>\n\t\t\n\t\t<view class=\"info-form\">\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<text class=\"form-label\">用户名</text>\n\t\t\t\t<view class=\"current-info\">{{ userInfo.username || '' }}</view>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<text class=\"form-label\">手机号</text>\n\t\t\t\t<view class=\"current-info\">{{ maskPhone(userInfo.phone) || '' }}</view>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<text class=\"form-label\">性别</text>\n\t\t\t\t<picker @change=\"bindGenderChange\" :value=\"genderIndex\" :range=\"genderOptions\">\n\t\t\t\t\t<view class=\"picker-content\">\n\t\t\t\t\t\t<text class=\"picker-text\">{{ genderOptions[genderIndex] }}</text>\n\t\t\t\t\t\t<text class=\"arrow\">></text>\n\t\t\t\t\t</view>\n\t\t\t\t</picker>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<text class=\"form-label\">生日</text>\n\t\t\t\t<picker mode=\"date\" :value=\"birthday\" @change=\"bindDateChange\" start=\"1950-01-01\" end=\"2010-12-31\">\n\t\t\t\t\t<view class=\"picker-content\">\n\t\t\t\t\t\t<text class=\"picker-text\">{{ birthday || '请选择生日' }}</text>\n\t\t\t\t\t\t<text class=\"arrow\">></text>\n\t\t\t\t\t</view>\n\t\t\t\t</picker>\n\t\t\t</view>\n\t\t\t\n\t\t\t<button class=\"submit-btn\" @click=\"submitUpdate\">保存修改</button>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\n\timport api from '@/utils/api.js';\n\t\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tuserInfo: {},\n\t\t\t\tgenderOptions: ['请选择', '男', '女'],\n\t\t\t\tgenderIndex: 0,\n\t\t\t\tbirthday: '',\n\t\t\t\tloading: false\n\t\t\t}\n\t\t},\n\t\tonLoad() {\n\t\t\t// 检查登录状态并获取用户信息\n\t\t\tthis.checkLoginStatus();\n\t\t\tthis.getUserInfo();\n\t\t},\n\t\tmethods: {\n\t\t\t// 检查登录状态\n\t\t\tcheckLoginStatus() {\n\t\t\t\tconst token = uni.getStorageSync('token');\n\t\t\t\tif (!token) {\n\t\t\t\t\tthis.promptLogin();\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\t// 获取用户信息\n\t\t\tgetUserInfo() {\n\t\t\t\tconst userInfo = uni.getStorageSync('userInfo');\n\t\t\t\tif (userInfo) {\n\t\t\t\t\tthis.userInfo = userInfo;\n\t\t\t\t\t// 设置性别选择器的默认值\n\t\t\t\t\tif (userInfo.gender) {\n\t\t\t\t\t\tthis.genderIndex = userInfo.gender;\n\t\t\t\t\t}\n\t\t\t\t\t// 设置生日\n\t\t\t\t\tif (userInfo.birthday) {\n\t\t\t\t\t\tthis.birthday = userInfo.birthday;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// 如果本地没有用户信息，从服务器获取\n\t\t\t\t\tapi.request({\n\t\t\t\t\t\turl: '/user/profile',\n\t\t\t\t\t\tmethod: 'GET'\n\t\t\t\t\t})\n\t\t\t\t\t.then(res => {\n\t\t\t\t\t\t\tif (res.data.code === 200 && res.data.data) {\n\t\t\t\t\t\t\t\tthis.userInfo = res.data.data;\n\t\t\t\t\t\t\t\t// 更新本地存储的用户信息\n\t\t\t\t\t\t\t\tuni.setStorageSync('userInfo', res.data.data);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// 设置性别选择器的默认值\n\t\t\t\t\t\t\t\tif (this.userInfo.gender) {\n\t\t\t\t\t\t\t\t\tthis.genderIndex = this.userInfo.gender;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// 设置生日\n\t\t\t\t\t\t\t\tif (this.userInfo.birthday) {\n\t\t\t\t\t\t\t\t\tthis.birthday = this.userInfo.birthday;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.catch(err => {\n\t\t\t\t\t\tconsole.error('获取用户信息失败:', err);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\t// 手机号脱敏显示\n\t\t\tmaskPhone(phone) {\n\t\t\t\tif (!phone || phone.length !== 11) {\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\t\t\t\treturn phone.substring(0, 3) + '****' + phone.substring(7);\n\t\t\t},\n\t\t\t\n\t\t\t// 性别选择器变化事件\n\t\t\tbindGenderChange(e) {\n\t\t\t\tthis.genderIndex = e.detail.value;\n\t\t\t},\n\t\t\t\n\t\t\t// 日期选择器变化事件\n\t\t\tbindDateChange(e) {\n\t\t\t\tthis.birthday = e.detail.value;\n\t\t\t},\n\t\t\t\n\t\t\t// 提交更新\n\t\t\tsubmitUpdate() {\n\t\t\t\tif (this.genderIndex === 0) {\n\t\t\t\t\tthis.showToast('请选择性别');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (!this.birthday) {\n\t\t\t\t\tthis.showToast('请选择生日');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis.loading = true;\n\t\t\t\t\n\t\t\t\t// 调用接口更新用户信息\n\t\t\t\tapi.request({\n\t\t\t\t\turl: '/user/profile',\n\t\t\t\t\tmethod: 'PUT',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tavatar: this.userInfo.avatar,\n\t\t\t\t\t\tgender: parseInt(this.genderIndex),\n\t\t\t\t\t\tbirthday: this.birthday,\n\t\t\t\t\t\tphone: this.userInfo.phone\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(res => {\n\t\t\t\t\t\tif (res.data.code === 200) {\n\t\t\t\t\t\t\tthis.showToast('信息更新成功', 'success');\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// 更新本地存储的用户信息\n\t\t\t\t\t\t\tconst userInfo = uni.getStorageSync('userInfo') || {};\n\t\t\t\t\t\t\tuserInfo.gender = parseInt(this.genderIndex);\n\t\t\t\t\t\t\tuserInfo.birthday = this.birthday;\n\t\t\t\t\t\t\tuni.setStorageSync('userInfo', userInfo);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// 更新成功后返回上一页\n\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\tuni.navigateBack();\n\t\t\t\t\t\t\t}, 1500);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.showToast(res.data.message || '信息更新失败');\n\t\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\t\tthis.showToast('网络错误，请稍后再试');\n\t\t\t\t})\n\t\t\t\t.finally(() => {\n\t\t\t\t\t\tthis.loading = false;\n\t\t\t\t});\n\t\t\t},\n\t\t\t\n\t\t\t// 提示登录\n\t\t\tpromptLogin() {\n\t\t\t\tuni.showModal({\n\t\t\t\t\ttitle: '提示',\n\t\t\t\t\tcontent: '请先登录',\n\t\t\t\t\tconfirmText: '去登录',\n\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\tif (res.confirm) {\n\t\t\t\t\t\t\tuni.navigateTo({\n\t\t\t\t\t\t\t\turl: '/pages/login/login'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tuni.navigateBack();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\t\n\t\t\t// 显示提示信息\n\t\t\tshowToast(title, icon = 'none') {\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle,\n\t\t\t\t\ticon\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style>\n\t.user-info-container {\n\t\tpadding: 20rpx;\n\t\tbackground-color: #121212;\n\t\tmin-height: 100vh;\n\t}\n\t\n\t.info-header {\n\t\tpadding: 30rpx 0;\n\t\tmargin-bottom: 20rpx;\n\t}\n\t\n\t.header-title {\n\t\tfont-size: 40rpx;\n\t\tfont-weight: bold;\n\t\tcolor: #ffffff;\n\t}\n\t\n\t.info-form {\n\t\tbackground-color: #1a1a1a;\n\t\tborder-radius: 20rpx;\n\t\tpadding: 30rpx;\n\t\tmargin-top: 30rpx;\n\t}\n\t\n\t.form-item {\n\t\tmargin-bottom: 30rpx;\n\t}\n\t\n\t.form-label {\n\t\tdisplay: block;\n\t\tfont-size: 28rpx;\n\t\tcolor: #ffffff;\n\t\tmargin-bottom: 15rpx;\n\t}\n\t\n\t.current-info {\n\t\theight: 80rpx;\n\t\tline-height: 80rpx;\n\t\tbackground-color: #2a2a2a;\n\t\tborder-radius: 10rpx;\n\t\tpadding: 0 20rpx;\n\t\tcolor: #888888;\n\t\tfont-size: 28rpx;\n\t\tword-break: break-all;\n\t}\n\t\n\t.picker-content {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\theight: 80rpx;\n\t\tbackground-color: #2a2a2a;\n\t\tborder-radius: 10rpx;\n\t\tpadding: 0 20rpx;\n\t}\n\t\n\t.picker-text {\n\t\tcolor: #ffffff;\n\t\tfont-size: 28rpx;\n\t}\n\t\n\t.arrow {\n\t\tfont-size: 28rpx;\n\t\tcolor: #888888;\n\t}\n\t\n\t.submit-btn {\n\t\tbackground-color: #7b68ee;\n\t\tcolor: #ffffff;\n\t\theight: 90rpx;\n\t\tline-height: 90rpx;\n\t\tfont-size: 32rpx;\n\t\tmargin-top: 50rpx;\n\t\tborder-radius: 45rpx;\n\t}\n</style> ","import MiniProgramPage from 'C:/Users/LXD/Desktop/奶茶点单系统/milktea-uniapp/pages/user/user-info.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","api"],"mappings":"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"}