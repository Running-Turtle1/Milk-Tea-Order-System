{"version":3,"file":"change-phone.js","sources":["pages/user/change-phone.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci9jaGFuZ2UtcGhvbmUudnVl"],"sourcesContent":["<template>\n\t<view class=\"change-phone-container\">\n\t\t<view class=\"phone-header\">\n\t\t\t<view class=\"header-title\">更换手机号</view>\n\t\t</view>\n\t\t\n\t\t<view class=\"phone-form\">\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<text class=\"form-label\">当前手机号</text>\n\t\t\t\t<view class=\"current-phone\">{{ maskPhone(currentPhone) }}</view>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"form-item\">\n\t\t\t\t<text class=\"form-label\">新手机号</text>\n\t\t\t\t<input type=\"number\" v-model=\"newPhone\" placeholder=\"请输入新手机号\" class=\"form-input\" maxlength=\"11\" placeholder-style=\"color: #666666;\" />\n\t\t\t</view>\n\t\t\t\n\t\t\t<button class=\"submit-btn\" @click=\"submitChange\">确认更换</button>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\n\timport api from '@/utils/api.js';\n\t\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tcurrentPhone: '',\n\t\t\t\tnewPhone: '',\n\t\t\t\tloading: false\n\t\t\t}\n\t\t},\n\t\tonLoad() {\n\t\t\t// 检查登录状态并获取用户手机号\n\t\t\tthis.checkLoginStatus();\n\t\t\tthis.getUserInfo();\n\t\t},\n\t\tmethods: {\n\t\t\t// 检查登录状态\n\t\t\tcheckLoginStatus() {\n\t\t\t\tconst token = uni.getStorageSync('token');\n\t\t\t\tif (!token) {\n\t\t\t\t\tthis.promptLogin();\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\t// 获取用户信息\n\t\t\tgetUserInfo() {\n\t\t\t\tconst userInfo = uni.getStorageSync('userInfo');\n\t\t\t\tif (userInfo && userInfo.phone) {\n\t\t\t\t\tthis.currentPhone = userInfo.phone;\n\t\t\t\t} else {\n\t\t\t\t\t// 获取token\n\t\t\t\t\tconst token = uni.getStorageSync('token');\n\t\t\t\t\tif (!token) {\n\t\t\t\t\t\tthis.promptLogin();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// 如果本地没有用户信息，从服务器获取\n\t\t\t\t\tapi.getUserInfo()\n\t\t\t\t\t\t.then(res => {\n\t\t\t\t\t\t\tif (res.data.code === 200 && res.data.data) {\n\t\t\t\t\t\t\t\tthis.currentPhone = res.data.data.phone || '';\n\t\t\t\t\t\t\t\t// 更新本地存储的用户信息\n\t\t\t\t\t\t\t\tuni.setStorageSync('userInfo', res.data.data);\n\t\t\t\t\t\t\t} else if (res.data.code === 403) {\n\t\t\t\t\t\t\t\tthis.showToast('登录已过期，请重新登录');\n\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\t// 清除token和用户信息\n\t\t\t\t\t\t\t\t\tuni.removeStorageSync('token');\n\t\t\t\t\t\t\t\t\tuni.removeStorageSync('userInfo');\n\t\t\t\t\t\t\t\t\t// 重定向到登录页\n\t\t\t\t\t\t\t\t\tuni.reLaunch({\n\t\t\t\t\t\t\t\t\t\turl: '/pages/login/login'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}, 1500);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch(err => {\n\t\t\t\t\t\t\tconsole.error('获取用户信息失败:', err);\n\t\t\t\t\t\t\tif (err.statusCode === 403) {\n\t\t\t\t\t\t\t\tthis.showToast('登录已过期，请重新登录');\n\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\t// 重定向到登录页\n\t\t\t\t\t\t\t\t\tuni.reLaunch({\n\t\t\t\t\t\t\t\t\t\turl: '/pages/login/login'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}, 1500);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\t// 手机号脱敏显示\n\t\t\tmaskPhone(phone) {\n\t\t\t\tif (!phone || phone.length !== 11) {\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\t\t\t\treturn phone.substring(0, 3) + '****' + phone.substring(7);\n\t\t\t},\n\t\t\t\n\t\t\t// 验证手机号\n\t\t\tvalidatePhone() {\n\t\t\t\tif (!this.newPhone) {\n\t\t\t\t\tthis.showToast('请输入新手机号');\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (!/^1[3-9]\\d{9}$/.test(this.newPhone)) {\n\t\t\t\t\tthis.showToast('请输入正确的手机号格式');\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (this.newPhone === this.currentPhone) {\n\t\t\t\t\tthis.showToast('新手机号不能与当前手机号相同');\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\t\n\t\t\t// 提交更换手机号\n\t\t\tsubmitChange() {\n\t\t\t\tif (!this.validatePhone()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis.loading = true;\n\t\t\t\t\n\t\t\t\t// 获取token\n\t\t\t\tconst token = uni.getStorageSync('token');\n\t\t\t\tif (!token) {\n\t\t\t\t\tthis.showToast('请先登录');\n\t\t\t\t\tthis.promptLogin();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// 调用接口更换手机号\n\t\t\t\tapi.updateUserInfo({\n\t\t\t\t\tphone: this.newPhone\n\t\t\t\t})\n\t\t\t\t\t.then(res => {\n\t\t\t\t\t\tif (res.data.code === 200) {\n\t\t\t\t\t\t\tthis.showToast('手机号更换成功', 'success');\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// 更新本地存储的用户信息\n\t\t\t\t\t\t\tconst userInfo = uni.getStorageSync('userInfo') || {};\n\t\t\t\t\t\t\tuserInfo.phone = this.newPhone;\n\t\t\t\t\t\t\tuni.setStorageSync('userInfo', userInfo);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// 更换成功后返回上一页\n\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\tuni.navigateBack();\n\t\t\t\t\t\t\t}, 1500);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// 处理各种错误情况\n\t\t\t\t\t\t\tif (res.data.code === 403) {\n\t\t\t\t\t\t\t\tthis.showToast('没有权限，请重新登录');\n\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\t// 清除token和用户信息\n\t\t\t\t\t\t\t\t\tuni.removeStorageSync('token');\n\t\t\t\t\t\t\t\t\tuni.removeStorageSync('userInfo');\n\t\t\t\t\t\t\t\t\t// 重定向到登录页\n\t\t\t\t\t\t\t\t\tuni.reLaunch({\n\t\t\t\t\t\t\t\t\t\turl: '/pages/login/login'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}, 1500);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthis.showToast(res.data.message || '手机号更换失败');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.catch(err => {\n\t\t\t\t\t\tconsole.error('请求失败:', err);\n\t\t\t\t\t\tif (err.statusCode === 403) {\n\t\t\t\t\t\t\tthis.showToast('登录已过期，请重新登录');\n\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t// 清除token和用户信息\n\t\t\t\t\t\t\t\tuni.removeStorageSync('token');\n\t\t\t\t\t\t\t\tuni.removeStorageSync('userInfo');\n\t\t\t\t\t\t\t\t// 重定向到登录页\n\t\t\t\t\t\t\t\tuni.reLaunch({\n\t\t\t\t\t\t\t\t\turl: '/pages/login/login'\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}, 1500);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.showToast('网络错误，请稍后再试');\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\tthis.loading = false;\n\t\t\t\t\t});\n\t\t\t},\n\t\t\t\n\t\t\t// 提示登录\n\t\t\tpromptLogin() {\n\t\t\t\tuni.showModal({\n\t\t\t\t\ttitle: '提示',\n\t\t\t\t\tcontent: '请先登录',\n\t\t\t\t\tconfirmText: '去登录',\n\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\tif (res.confirm) {\n\t\t\t\t\t\t\tuni.navigateTo({\n\t\t\t\t\t\t\t\turl: '/pages/login/login'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tuni.navigateBack();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\t\n\t\t\t// 显示提示信息\n\t\t\tshowToast(title, icon = 'none') {\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle,\n\t\t\t\t\ticon\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style>\n\t.change-phone-container {\n\t\tpadding: 20rpx;\n\t\tbackground-color: #121212;\n\t\tmin-height: 100vh;\n\t}\n\t\n\t.phone-header {\n\t\tpadding: 30rpx 0;\n\t\tmargin-bottom: 20rpx;\n\t}\n\t\n\t.header-title {\n\t\tfont-size: 40rpx;\n\t\tfont-weight: bold;\n\t\tcolor: #ffffff;\n\t}\n\t\n\t.phone-form {\n\t\tbackground-color: #1a1a1a;\n\t\tborder-radius: 20rpx;\n\t\tpadding: 30rpx;\n\t\tmargin-top: 30rpx;\n\t}\n\t\n\t.form-item {\n\t\tmargin-bottom: 30rpx;\n\t}\n\t\n\t.form-label {\n\t\tdisplay: block;\n\t\tfont-size: 28rpx;\n\t\tcolor: #ffffff;\n\t\tmargin-bottom: 15rpx;\n\t}\n\t\n\t.current-phone {\n\t\theight: 80rpx;\n\t\tline-height: 80rpx;\n\t\tbackground-color: #2a2a2a;\n\t\tborder-radius: 10rpx;\n\t\tpadding: 0 20rpx;\n\t\tcolor: #888888;\n\t\tfont-size: 28rpx;\n\t}\n\t\n\t.form-input {\n\t\tbackground-color: #2a2a2a;\n\t\theight: 80rpx;\n\t\tborder-radius: 10rpx;\n\t\tpadding: 0 20rpx;\n\t\tcolor: #ffffff;\n\t\twidth: 100%;\n\t\tbox-sizing: border-box;\n\t}\n\t\n\t.submit-btn {\n\t\tbackground-color: #7b68ee;\n\t\tcolor: #ffffff;\n\t\theight: 90rpx;\n\t\tline-height: 90rpx;\n\t\tfont-size: 32rpx;\n\t\tmargin-top: 50rpx;\n\t\tborder-radius: 45rpx;\n\t}\n</style> ","import MiniProgramPage from 'C:/Users/LXD/Desktop/奶茶点单系统/milktea-uniapp/pages/user/change-phone.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","api"],"mappings":"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"}